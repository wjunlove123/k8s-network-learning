host 192.168.2.66

clab + cilium + bgp control plane enable
configuration  steps:
1. setup k8s cluster
2. setup clab cluster
3. config leaf switch(only config leaf switch)
4. enable the cilium BGP Control Plane
5. config spine switch 














Follow the stpes to execute, we should make sure the ds/cilium under running status firstly. If we find the imagePull failure, we need load the configuration into the leaf and spine swtich.

Once clab deploy done, the INTERNAL-IP will be fulled.(the befor is empty)!!!
root@hive:~/wcni/cilium/c-cilium-bgp-control-plane# kk get nodes -o wide 
NAME                     STATUS   ROLES                  AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION      CONTAINER-RUNTIME
clab-bgp-control-plane   NotReady    control-plane,master   47m   v1.23.4   10.1.5.10     <none>        Ubuntu 21.10   5.15.0-53-generic   containerd://1.5.10
clab-bgp-worker          NotReady    <none>                 46m   v1.23.4   10.1.5.11     <none>        Ubuntu 21.10   5.15.0-53-generic   containerd://1.5.10
clab-bgp-worker2         NotReady    <none>                 46m   v1.23.4   10.1.8.10     <none>        Ubuntu 21.10   5.15.0-53-generic   containerd://1.5.10
clab-bgp-worker3         NotReady    <none>                 46m   v1.23.4   10.1.8.11     <none>        Ubuntu 21.10   5.15.0-53-generic   containerd://1.5.10

So with the NotReady status, we can install the cilium CNI into the system.
#helm install cilium cilium/cilium --set k8sServiceHost=$controller_node --set k8sServicePort=6443 --version 1.12.0 --namespace kube-system --set debug.enabled=true --set debug.verbose=datapath --set monitorAggregation=none --set ipam.mode=cluster-pool --set cluster.name=clab-bgp-cplane --set tunnel=disabled --set ipam.mode=kubernetes --set ipv4NativeRoutingCIDR=10.0.0.0/8 --set bgpControlPlane.enabled=true --set k8s.requireIPv4PodCIDR=true

helm repo add cilium https://helm.cilium.io/
helm install -n kube-system cilium cilium/cilium --version v1.12.0 -f ./values.yaml

About the topo:
we changed the 192.168.5.x to 10.1.5.x
               192.168.8.x to 10.1.8.x
eog ./1-Cilium-BGP-Control-Plane.png
